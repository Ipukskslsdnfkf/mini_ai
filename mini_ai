<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pieni S√§√§nt√∂pohjainen Robotti</title>
    <!-- Ladataan Tailwind CSS ulkoasua varten -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Asetetaan Inter-fontti */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        /* Asetetaan chat-ikkunalle maksimikorkeus ja vieritys */
        #chat-history {
            height: calc(100% - 6rem); /* Laske tila input-alueelta */
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        /* Korostetaan botin viestit */
        .bot-message {
            background-color: #e0f2fe; /* Light blue for bot */
        }
        /* Korostetaan k√§ytt√§j√§n viestit */
        .user-message {
            background-color: #d1fae5; /* Light green for user */
        }

        /* --- Kirjoitusindikaattorin (Bouncing Dots) Tyylit --- */
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background-color: #e0f2fe; /* Match bot-message color */
            border-radius: 12px 12px 12px 0; /* Match bot message style */
            max-width: fit-content;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Match shadow-sm */
        }
        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: #3b82f6; /* A nice blue color */
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.2s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes bounce {
            0%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <!-- P√§√§kontti, joka toimii chat-ikkunana -->
    <div id="chat-container" class="bg-white shadow-2xl rounded-xl w-full max-w-lg h-[85vh] flex flex-col transition-all duration-300">
        <!-- Otsikko -->
        <div class="p-4 bg-indigo-600 text-white rounded-t-xl shadow-md flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <h1 class="text-xl font-semibold">Pieni Robotti</h1>
        </div>

        <!-- Chat-historia -->
        <div id="chat-history" class="p-4 flex-grow space-y-4">
            <!-- Botin aloitussanoma -->
            <div class="flex justify-start">
                <div class="bot-message p-3 rounded-lg max-w-xs shadow-sm">
                    <p class="text-gray-800">Terve! Olen pieni s√§√§nt√∂pohjainen teko√§ly. Kokeile sanoa "Hei" tai kysy√§ "Mit√§ kuuluu?".</p>
                </div>
            </div>
        </div>

        <!-- Sy√∂tekentt√§ ja L√§het√§-painike -->
        <div class="p-4 border-t border-gray-200 flex space-x-2">
            <input type="text" id="user-input" placeholder="Kirjoita viesti..."
                   class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150"
                   onkeydown="if(event.key === 'Enter') sendMessage()">
            <button onclick="sendMessage()"
                    class="bg-indigo-600 text-white p-3 rounded-lg font-medium hover:bg-indigo-700 transition duration-150 shadow-md active:shadow-none active:bg-indigo-800">
                L√§het√§
            </button>
        </div>
    </div>

    <script>
        const chatHistory = document.getElementById('chat-history');
        const userInput = document.getElementById('user-input');

        // ** TILA (STATE) MUUTTUJAT **
        let expectingColor = false;
        let expectingTeam = false;
        let expectingJoke = false; // Tila muistaa, jos on juuri kerrottu vitsi
        let expectingMinecraftBlock = false; // Tila muistaa, jos odotetaan Minecraft-lohkoa
        let expectingFortnitePlatform = false; // UUSI: Tila muistaa, jos odotetaan Fortnite-alustaa
        let expectingMovieGenre = false; // UUSI: Tila muistaa, jos odotetaan elokuvan/sarjan genre√§
        // Global variable to hold the typing indicator element reference
        let typingIndicatorElement = null;

        const JOKES = [
            "Mit√§ yhteist√§ on banaanilla ja tietokoneella? Molemmilla on kuori!",
            "Miksi h√§m√§h√§kki on hyv√§ netiss√§? Koska sill√§ on niin monta seitti√§!",
            "Mit√§ kala sanoo, kun se t√∂rm√§√§ sein√§√§n? DAM!",
            "Miksi kummitus ei mennyt kouluun? Koska sill√§ oli flunssa.",
            "Miksi p√∂ll√∂ on viisas? Koska se tiet√§√§, ettei ole n√§hnyt kaikkea!"
        ];

        // Funktio viestin lis√§√§miseksi chat-historiaan
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = `p-3 rounded-xl max-w-xs shadow-md text-sm ${
                sender === 'user' ? 'user-message rounded-br-none' : 'bot-message rounded-tl-none'
            }`;

            contentDiv.innerHTML = `<p class="text-gray-800">${text}</p>`;
            messageDiv.appendChild(contentDiv);
            chatHistory.appendChild(messageDiv);

            // Vierit√§ automaattisesti alas uusimman viestin kohdalle
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // --- Kirjoitusindikaattorin (Typing Indicator) Toiminnallisuus ---

        // Funktio n√§ytt√§m√§√§n pomppivat pisteet
        function showTypingIndicator() {
            // 1. Luo ulompi container (simuloi viestin sijainnin)
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex justify-start`;
            
            // 2. Luo sisempi content div, jossa on itse indikaattori
            const contentDiv = document.createElement('div');
            contentDiv.className = 'typing-indicator'; 

            // 3. Luo kolme pomppivaa pistett√§
            for (let i = 1; i <= 3; i++) {
                const dot = document.createElement('div');
                dot.className = 'typing-dot';
                contentDiv.appendChild(dot);
            }

            messageDiv.appendChild(contentDiv);
            chatHistory.appendChild(messageDiv);
            
            typingIndicatorElement = messageDiv; // Tallenna viite elementtiin poistoa varten
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Funktio poistamaan pomppivat pisteet
        function removeTypingIndicator() {
            if (typingIndicatorElement) {
                typingIndicatorElement.remove();
                typingIndicatorElement = null;
            }
        }
        
        // Funktio vitsin kertomiseen
        function tellJoke() {
            const randomJoke = JOKES[Math.floor(Math.random() * JOKES.length)];
            
            // Asetetaan tila, jotta seuraavaksi voidaan pyyt√§√§ toista vitsi√§
            expectingJoke = true; 
            return `${randomJoke} (Sano 'viel√§ yksi', jos haluat toisen!)`;
        }

        // Teko√§lyn s√§√§nt√∂pohjainen vastauslogiikka
        function respondToUser(message) {
            // Muutetaan viesti pieniksi kirjaimiksi vertailua varten
            const normalizedMessage = message.toLowerCase().trim();

            let response = null;
            let clearState = true; // Oletus: nollataan tila jokaisen vastauksen j√§lkeen

            // 1. KONTEKSTUAALISET VASTAUKSET
            
            // UUSI KONTEKSTI: Jos odotetaan elokuvan/sarjan genre√§
            if (expectingMovieGenre) {
                expectingMovieGenre = false;
                const movieResponse = (genre) => `${genre.charAt(0).toUpperCase() + genre.slice(1)} on loistava valinta! Hyv√§t ${genre.toLowerCase()}-leffat ovat aina viihdytt√§vi√§.`;

                if (normalizedMessage.includes('toiminta') || normalizedMessage.includes('action')) {
                    response = movieResponse('Toiminta');
                } else if (normalizedMessage.includes('komedia') || normalizedMessage.includes('comedy') || normalizedMessage.includes('hauska')) {
                    response = movieResponse('Komedia');
                } else if (normalizedMessage.includes('scifi') || normalizedMessage.includes('tiede')) {
                    response = movieResponse('Sci-fi');
                } else if (normalizedMessage.includes('fantasia') || normalizedMessage.includes('fantasy')) {
                    response = movieResponse('Fantasia');
                } else if (normalizedMessage.includes('kauhu') || normalizedMessage.includes('horror')) {
                    response = movieResponse('Kauhu');
                } else {
                    response = "Mielenkiintoista! Genrevaihtoehtoja on paljon. Minusta hyv√§ juoni on aina t√§rkein!";
                }
            }

            // KONTEKSTI: Jos odotetaan Fortnite-alustaa
            else if (expectingFortnitePlatform) {
                expectingFortnitePlatform = false;
                if (normalizedMessage.includes('pc') || normalizedMessage.includes('tietokone') || normalizedMessage.includes('konsoli') || normalizedMessage.includes('ps') || normalizedMessage.includes('xbox') || normalizedMessage.includes('switch')) {
                    response = "Mahtavaa! Pelaaminen eri alustoilla on hauskaa. Toivottavasti saat paljon voittoja!";
                } else {
                    response = "Fortnite√§ voi pelata monella laitteella. Kokeile sanoa esimerkiksi 'PC' tai 'konsoli'!";
                }
            }
            
            // KONTEKSTI: Jos odotetaan Minecraft-lohkoa
            else if (expectingMinecraftBlock) {
                expectingMinecraftBlock = false;
                
                // P√§ivitetty Minecraft-vastauslogiikka
                const blockResponse = (blockName) => `Ahaa, ${blockName} on klassikko! Se on yksi t√§rkeimmist√§ lohkoista rakentamiseen ja maailman tutkimiseen. Hieno valinta!`;

                if (normalizedMessage.includes('ruoho') || normalizedMessage.includes('grass') || normalizedMessage.includes('multa') || normalizedMessage.includes('dirt')) {
                    response = blockResponse('Ruoho/Multa');
                } else if (normalizedMessage.includes('timantti') || normalizedMessage.includes('diamond')) {
                    response = blockResponse('Timantti');
                } else if (normalizedMessage.includes('kivi') || normalizedMessage.includes('stone')) {
                    response = blockResponse('Kivi');
                } else if (normalizedMessage.length > 3) { // Jos vastaus ei ollut tyhj√§, mutta ei t√§sm√§nnyt mihink√§√§n tiettyyn lohkoon
                    response = `${normalizedMessage.charAt(0).toUpperCase() + normalizedMessage.slice(1)} on varmasti hy√∂dyllinen lohko! Minecraftissa on niin paljon valinnanvaraa!`;
                } else {
                     response = "Ymm√§rsin, ett√§ puhumme lohkoista, mutta en ole varma mik√§ juuri tuo oli! Minecraftissa on niin paljon valinnanvaraa!";
                }
            }
            // KONTEKSTI: Jos joukkuetta odotetaan (jalkapallo-kysymys)
            else if (expectingTeam) {
                expectingTeam = false; // Tila nollataan heti
                
                // Tunnistetut esimerkkijoukkueet
                if (normalizedMessage.includes('hjk') || normalizedMessage.includes('manchester') || normalizedMessage.includes('barcelona') || normalizedMessage.includes('real madrid') || normalizedMessage.includes('lopa') || normalizedMessage.includes('liverpool') || normalizedMessage.includes('bayern munchen')) {
                    response = "Vau, hieno valinta! Se on tunnettu ja menestynyt joukkue. Toivottavasti heill√§ on hyv√§ kausi!";
                } else {
                    response = "Kiitos tiedosta! Kaikki joukkueet tarvitsevat faneja. Onko sinulla jokin muu harrastus josta haluaisit kertoa?";
                }
            }
            
            // KONTEKSTI: Jos v√§ri√§ odotetaan (auto-kysymys)
            else if (expectingColor) {
                expectingColor = false; 

                // Tarkistetaan, sis√§lt√§√§k√∂ vastaus jonkin tunnistetun v√§rin
                if (normalizedMessage.includes('punainen') || normalizedMessage.includes('musta') || normalizedMessage.includes('valkoinen') || normalizedMessage.includes('keltainen') || normalizedMessage.includes('harmaa') || normalizedMessage.includes('sininen')) {
                    response = `Niinp√§, ${normalizedMessage.split(' ')[0]} on todella suosittu ja hieno valinta!`;
                } else {
                    response = "Se on hyv√§. Minusta sininen on aina tyylik√§s valinta autoon! Mit√§ muuta voisin auttaa sinua tiet√§m√§√§n?";
                }
            }

            // KONTEKSTI: Odotetaan toista vitsi√§
            else if (expectingJoke && (normalizedMessage.includes('viel√§ yksi') || normalizedMessage.includes('toinen') || normalizedMessage.includes('uusi vitsi'))) {
                 response = tellJoke();
                 clearState = false; // Pidet√§√§n tila p√§√§ll√§ uutta vitsi√§ varten
            }


            // 2. P√Ñ√ÑS√Ñ√ÑNN√ñT (ajetaan vain, jos kontekstuaalista vastausta ei l√∂ytynyt)
            if (!response) {
                // Aseta kaikki tila-muuttujat pois p√§√§lt√§, jos k√§ytt√§j√§ siirtyi uuteen aiheeseen
                if (expectingJoke) expectingJoke = false;
                if (expectingMinecraftBlock) expectingMinecraftBlock = false;
                if (expectingFortnitePlatform) expectingFortnitePlatform = false;
                if (expectingMovieGenre) expectingMovieGenre = false; // Nollataan my√∂s uusi tila

                if (normalizedMessage.includes('hei') || normalizedMessage.includes('moi') || normalizedMessage.includes('terve')) {
                    response = "Hei! Kiva, kun otit yhteytt√§. Kuinka voin olla avuksi?";
                } 
                // S√Ñ√ÑNT√ñ: Hymi√∂
                else if (normalizedMessage === ':)') {
                    response = ":)";
                }
                // S√Ñ√ÑNT√ñ: Vitsi
                else if (normalizedMessage.includes('kerro vitsi') || normalizedMessage.includes('vitsi')) {
                    response = tellJoke();
                    clearState = false; // Pidet√§√§n tila p√§√§ll√§ uutta vitsi√§ varten
                }
                // S√Ñ√ÑNT√ñ: OK-vastaus
                else if (normalizedMessage === 'ok') {
                    response = "Ok, haluatko vi√§l√§ jotain?";
                }
                else if (normalizedMessage.includes('mit√§ kuuluu') || normalizedMessage.includes('kuulumiset')) {
                    response = "Kiitos kysym√§st√§, minulla on kaikki hyvin. Olen valmis ty√∂skentelem√§√§n! Ent√§ sinulla?";
                } 
                // UUSI S√Ñ√ÑNT√ñ: Hae verkosta (SIMULOITU)
                else if (normalizedMessage.includes('hae verkosta') || normalizedMessage.includes('google') || normalizedMessage.includes('etsi netist√§')) {
                    response = "Olen vain pieni robotti enk√§ p√§√§se nettiin. S√§√§li! Minun t√§ytyy luottaa niihin tietoihin, jotka minulla on jo koodissa. Kysy minulta 'mit√§ osaat', niin kerron mist√§ tied√§n!";
                }
                // S√Ñ√ÑNT√ñ: Mit√§ osaat (P√ÑIVITETTY Elokuvien/Sarjojen KANSSA)
                else if (normalizedMessage.includes('mit√§ osaat') || normalizedMessage.includes('aiheita')) {
                    response = "Osaan keskustella seuraavista aiheista: tervehdysten, autojen, lemmikkien, harrastusten (erityisesti jalkapallon), Minecraftin, Fortniten, h√§t√§taktiikoiden, elokuvien ja sarjojen genren sek√§ vitsejen kertomisesta. Kokeile sanoa 'elokuva', 'Fortnite' tai 'h√§t√§poistumistaktiikka'!";
                }
                // UUSI S√Ñ√ÑNT√ñ: Elokuvat/Sarjat
                else if (normalizedMessage.includes('elokuva') || normalizedMessage.includes('sarja') || normalizedMessage.includes('leffa')) {
                    response = "Elokuvat ja sarjat ovat loistava tapa rentoutua! Oletko enemm√§n toiminnan, komedian vai kenties fantasian yst√§v√§? Mik√§ on sinun suosikkigenresi?";
                    expectingMovieGenre = true;
                }
                // S√Ñ√ÑNT√ñ: H√§t√§poistumistaktiikka
                else if (normalizedMessage.includes('taktiikka') || normalizedMessage.includes('h√§t√§poistumistaktiikka') || normalizedMessage.includes('pakoon')) {
                    response = "H√§t√§poistumistaktiikka on t√§rke√§√§ Battle Royale -peleiss√§! Paras tapa on pysy√§ rauhallisena, katsoa ymp√§rille ja rakentaa suojaksi sein√§t nopeasti, jos joudut tulituksen alle. √Ñl√§ panikoi, vaan siirry turvaan!";
                }
                // S√Ñ√ÑNT√ñ: Fortnite
                else if (normalizedMessage.includes('fortnite')) {
                    response = "Fortnite on suosittu Battle Royale -peli, jossa voi rakentaa ja pelata kavereiden kanssa! Mit√§ kautta yleens√§ pelaat sit√§?";
                    expectingFortnitePlatform = true; // Asetetaan TILA T√ÑH√ÑN
                } 
                // S√Ñ√ÑNT√ñ: Minecraft (Asettaa tilan kysymyksen j√§lkeen)
                else if (normalizedMessage.includes('minecraft')) {
                    response = "Minecraft on todella suosittu hiekkalaatikkopeli, jossa voi rakentaa melkein mit√§ tahansa! Se kehitt√§√§ luovuutta ja ongelmanratkaisutaitoja. Mik√§ on suosikkilohkosi peliss√§?";
                    expectingMinecraftBlock = true; // Asetetaan TILA T√ÑH√ÑN
                } 
                else if (normalizedMessage.includes('auto') || normalizedMessage.includes('autot') || normalizedMessage.includes('ajoneuvo')) {
                    // Auto-s√§√§nt√∂: Asettaa tilan ja kysyy kysymyksen
                    response = "Autot ovat todella mielenkiintoisia! Ne voivat olla henkil√∂autoja, busseja tai kuorma-autoja. T√§rkeint√§ autossa on turvallisuus. Muista aina k√§ytt√§√§ turvavy√∂t√§, kun olet kyydiss√§! Mik√§ on sinun suosikkiv√§risi autossa?";
                    expectingColor = true; // Asetetaan tila t√§h√§n
                } 
                // S√Ñ√ÑNT√ñ: Harrastukset
                else if (normalizedMessage.includes('harrastus') || normalizedMessage.includes('vapaa-aika') || normalizedMessage.includes('mit√§ teet')) {
                    response = "Harrastukset ovat t√§rkeit√§! Pelaatko jalkapalloa, luetko kirjoja vai harrastatko koodausta? Kerro minulle suosikkiharrastuksesi!";
                }
                // S√Ñ√ÑNT√ñ: Jalkapallo (asettaa tilan seuraavaa vastausta varten)
                else if (normalizedMessage.includes('jalkapallo') || normalizedMessage.includes('futis')) {
                    response = "Jalkapallo on hauska ja suosittu joukkuelaji! Siin√§ p√§√§see juoksemaan ja tapaamaan kavereita. Kuka on suosikkijoukkueesi?";
                    expectingTeam = true; // Asetetaan tila t√§h√§n
                }
                // Spesifi s√§√§nt√∂ kissalle
                else if (normalizedMessage.includes('kissa')) {
                    response = "Kissat üêà ovat suloisia ja usein aika itsen√§isi√§! Ne tykk√§√§v√§t nukkua paljon. Onko sinulla kissa vai mietitk√∂ kissan hankkimista?";
                } 
                // Spesifi s√§√§nt√∂ koiralle
                else if (normalizedMessage.includes('koira')) {
                    response = "Koirat üêï ovat uskomattoman uskollisia ja leikkisi√§ yst√§vi√§! Ne tarvitsevat paljon liikuntaa ja huomiota. Mik√§ on sinun lempikoirarotusi?";
                }
                // Yleinen lemmikki-s√§√§nt√∂
                else if (normalizedMessage.includes('lemmikki') || normalizedMessage.includes('el√§in')) {
                    response = "El√§imet üêæ ovat ihania! Puhutaan lemmikeist√§. Onko sinulla lemmikki√§? Jos on, mik√§ se on?";
                } 
                else if (normalizedMessage.includes('s√§√§') || normalizedMessage.includes('ilma')) {
                    response = "Minulla ei ole p√§√§sy√§ reaaliaikaiseen s√§√§tietoon, mutta toivon sinulle kaunista ja aurinkoista p√§iv√§√§!";
                } else if (normalizedMessage.includes('ik√§') || normalizedMessage.includes('syntynyt')) {
                    response = "Olen pieni s√§√§nt√∂pohjainen ohjelma, enk√§ tied√§ tarkkaa syntym√§aikaani. Olen tosin juuri nyt valmis oppimaan uutta!";
                } else if (normalizedMessage.includes('kiitos')) {
                     response = "Ole hyv√§! Autan mielell√§ni.";
                } 
                // S√Ñ√ÑNT√ñ: Kirjoitusvirheen tunnistus (pitk√§t, tunnistamattomat sanat)
                else {
                    // Tarkistetaan, onko kyseess√§ pitk√§, ep√§tavallinen jono
                    if (normalizedMessage.length > 15 && !normalizedMessage.includes(' ')) {
                        response = "Taisi tulla kirjoitusvirhe : D";
                    } else {
                        // Catch-all vastaus
                        response = "En tainnut ymm√§rt√§√§. Kysy minulta 'mit√§ osaat', niin kerron sinulle mist√§ voimme keskustella!";
                    }
                }
            }

            // 1. N√§yt√§ kirjoitusindikaattori heti
            showTypingIndicator();

            // 2. Aseta viive vastaukselle (1000ms = 1 sekunti)
            setTimeout(() => {
                // 3. Poista kirjoitusindikaattori
                removeTypingIndicator();
                
                // 4. Lis√§√§ varsinainen vastaus
                addMessage(response, 'bot');
            }, 1000);
        }

        // P√§√§funktio k√§ytt√§j√§n viestin l√§hett√§miseen
        function sendMessage() {
            const message = userInput.value.trim();

            if (message === '') {
                return; // √Ñl√§ l√§het√§ tyhj√§√§ viesti√§
            }

            // Lis√§√§ k√§ytt√§j√§n viesti
            addMessage(message, 'user');

            // Pyyd√§ botilta vastaus
            respondToUser(message);

            // Tyhjenn√§ sy√∂tekentt√§
            userInput.value = '';
        }

        // Lis√§t√§√§n Enter-tuki sy√∂tekentt√§√§n varmuuden vuoksi, vaikka se on jo HTML:ss√§
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
